import GraphemeSplitter from "grapheme-splitter";

const splitter = new GraphemeSplitter();

// Peta karakter huruf fancy ke huruf biasa (A-Z dan 0-9)
const fancyCharMap = {
  // Cyrillic â†’ Latin (Visual Similarity)
  'Ð': 'A', 'Ð‘': '6', 'Ð’': 'B', 'Ð“': 'r', 'Ð”': 'A', 'Ð•': 'E', 'Ð': 'E', 'Ð–': 'X', 'Ð—': '3',
  'Ð˜': 'N', 'Ð™': 'N', 'Ðš': 'K', 'Ð›': 'L', 'Ðœ': 'M', 'Ð': 'H', 'Ðž': 'O', 'ÐŸ': 'N', 'Ð ': 'P',
  'Ð¡': 'C', 'Ð¢': 'T', 'Ð£': 'Y', 'Ð¤': 'O', 'Ð¥': 'X', 'Ð¦': 'U', 'Ð§': '4', 'Ð¨': 'W', 'Ð©': 'W',
  'Ð«': 'bl', 'Ð­': '3', 'Ð®': 'IO', 'Ð¯': 'R',

  'Ð°': 'a', 'Ð±': '6', 'Ð²': 'b', 'Ð³': 'r', 'Ð´': 'a', 'Ðµ': 'e', 'Ñ‘': 'e', 'Ð¶': 'x', 'Ð·': '3',
  'Ð¸': 'n', 'Ð¹': 'n', 'Ðº': 'k', 'Ð»': 'l', 'Ð¼': 'm', 'Ð½': 'h', 'Ð¾': 'o', 'Ð¿': 'n', 'Ñ€': 'p',
  'Ñ': 'c', 'Ñ‚': 't', 'Ñƒ': 'y', 'Ñ„': 'o', 'Ñ…': 'x', 'Ñ†': 'u', 'Ñ‡': '4', 'Ñˆ': 'w', 'Ñ‰': 'w',
  'Ñ‹': 'bl', 'Ñ': '3', 'ÑŽ': 'io', 'Ñ': 'r',

  // Latin Fancy Letters (Visual Forms A-Z)
  'á—©': 'a', 'á—·': 'b', 'á‘•': 'c', 'á—ª': 'd', 'á—´': 'e', 'á–´': 'f',
  'á˜œ': 'g', 'á•¼': 'h', 'á†': 'i', 'á’': 'j', 'á›•': 'k', 'á’ª': 'l',
  'á—°': 'm', 'á‘Ž': 'n', 'á—': 'o', 'áª': 'o', 'á‘­': 'p', 'á‘«': 'q',
  'á–‡': 'r', 'á”•': 's', 'á‘¦': 't', 'á‘Œ': 'u', 'á¯': 'v', 'á—¯': 'w',
  'á™­': 'x', 'á–»': 'y', 'á˜”': 'z',

  // Bold Math (ð—” - ð—­)
  'ð—”': 'a', 'ð—•': 'b', 'ð—–': 'c', 'ð——': 'd', 'ð—˜': 'e', 'ð—™': 'f',
  'ð—š': 'g', 'ð—›': 'h', 'ð—œ': 'i', 'ð—': 'j', 'ð—ž': 'k', 'ð—Ÿ': 'l',
  'ð— ': 'm', 'ð—¡': 'n', 'ð—¢': 'o', 'ð—£': 'p', 'ð—¤': 'q', 'ð—¥': 'r',
  'ð—¦': 's', 'ð—§': 't', 'ð—¨': 'u', 'ð—©': 'v', 'ð—ª': 'w', 'ð—«': 'x',
  'ð—¬': 'y', 'ð—­': 'z',

  // Stylized Cursive (Mathematical Script)
  'ð’œ': 'a', 'â„¬': 'b', 'ð’ž': 'c', 'ð’Ÿ': 'd', 'â„°': 'e', 'â„±': 'f',
  'ð’¢': 'g', 'â„‹': 'h', 'â„': 'i', 'ð’¥': 'j', 'ð’¦': 'k', 'â„’': 'l',
  'â„³': 'm', 'ð’©': 'n', 'ð’ª': 'o', 'ð’«': 'p', 'ð’¬': 'q', 'â„›': 'r',
  'ð’®': 's', 'ð’¯': 't', 'ð’°': 'u', 'ð’±': 'v', 'ð’²': 'w', 'ð’³': 'x',
  'ð’´': 'y', 'ð’µ': 'z',
  'ð’¶': 'a', 'ð’·': 'b', 'ð’¸': 'c', 'ð’¹': 'd', 'â„¯': 'e', 'ð’»': 'f',
  'ð“°': 'g', 'ð’½': 'h', 'ð’¾': 'i', 'ð’¿': 'j', 'ð“€': 'k', 'ð“': 'l',
  'ð“‚': 'm', 'ð“ƒ': 'n', 'â„´': 'o', 'ð“…': 'p', 'ð“†': 'q', 'ð“‡': 'r',
  'ð“ˆ': 's', 'ð“‰': 't', 'ð“Š': 'u', 'ð“‹': 'v', 'ð“Œ': 'w', 'ð“': 'x',
  'ð“Ž': 'y', 'ð“': 'z',

  // Angka fancy
  'ðŸŽ': '0', 'ðŸ': '1', 'ðŸ': '2', 'ðŸ‘': '3', 'ðŸ’': '4',
  'ðŸ“': '5', 'ðŸ”': '6', 'ðŸ•': '7', 'ðŸ–': '8', 'ðŸ—': '9',

  // Fullwidth Letters
  'ï¼¡': 'A', 'ï¼¢': 'B', 'ï¼£': 'C', 'ï¼¤': 'D', 'ï¼¥': 'E', 'ï¼¦': 'F',
  'ï¼§': 'G', 'ï¼¨': 'H', 'ï¼©': 'I', 'ï¼ª': 'J', 'ï¼«': 'K', 'ï¼¬': 'L',
  'ï¼­': 'M', 'ï¼®': 'N', 'ï¼¯': 'O', 'ï¼°': 'P', 'ï¼±': 'Q', 'ï¼²': 'R',
  'ï¼³': 'S', 'ï¼´': 'T', 'ï¼µ': 'U', 'ï¼¶': 'V', 'ï¼·': 'W', 'ï¼¸': 'X',
  'ï¼¹': 'Y', 'ï¼º': 'Z',
  'ï½': 'a', 'ï½‚': 'b', 'ï½ƒ': 'c', 'ï½„': 'd', 'ï½…': 'e', 'ï½†': 'f',
  'ï½‡': 'g', 'ï½ˆ': 'h', 'ï½‰': 'i', 'ï½Š': 'j', 'ï½‹': 'k', 'ï½Œ': 'l',
  'ï½': 'm', 'ï½Ž': 'n', 'ï½': 'o', 'ï½': 'p', 'ï½‘': 'q', 'ï½’': 'r',
  'ï½“': 's', 'ï½”': 't', 'ï½•': 'u', 'ï½–': 'v', 'ï½—': 'w', 'ï½˜': 'x',
  'ï½™': 'y', 'ï½š': 'z',

  // Fraktur Letters
  'ð”„': 'A', 'ð”…': 'B', 'ð”‡': 'D', 'ð”ˆ': 'E', 'ð”‰': 'F', 'ð”Š': 'G',
  'ð”': 'J', 'ð”Ž': 'K', 'ð”': 'L', 'ð”': 'M', 'ð”‘': 'N', 'ð”’': 'O',
  'ð”“': 'P', 'ð””': 'Q', 'ð”–': 'S', 'ð”˜': 'U', 'ð”™': 'V', 'ð”š': 'W',
  'ð”›': 'X', 'ð”œ': 'Y', 'ð”·': 'Z',
  'ð”ž': 'a', 'ð”Ÿ': 'b', 'ð” ': 'c', 'ð”¡': 'd', 'ð”¢': 'e', 'ð”£': 'f',
  'ð”¤': 'g', 'ð”¥': 'h', 'ð”¦': 'i', 'ð”§': 'j', 'ð”¨': 'k', 'ð”©': 'l',
  'ð”ª': 'm', 'ð”«': 'n', 'ð”¬': 'o', 'ð”­': 'p', 'ð”®': 'q', 'ð”¯': 'r',
  'ð”°': 's', 'ð”±': 't', 'ð”²': 'u', 'ð”³': 'v', 'ð”´': 'w', 'ð”µ': 'x',
  'ð”¶': 'y', 'ð”·': 'z',

  // Double-Struck Letters
  'ð”¸': 'A', 'ð”¹': 'B', 'â„‚': 'C', 'ð”»': 'D', 'ð”¼': 'E', 'â„±': 'F',
  'ð”¾': 'G', 'â„': 'H', 'ð•€': 'I', 'ð•': 'J', 'ð•‚': 'K', 'ð•ƒ': 'L',
  'ð•„': 'M', 'â„•': 'N', 'ð•†': 'O', 'â„™': 'P', 'â„š': 'Q', 'â„': 'R',
  'ð•Š': 'S', 'ð•‹': 'T', 'ð•Œ': 'U', 'ð•': 'V', 'ð•Ž': 'W', 'ð•': 'X',
  'ð•': 'Y', 'â„¤': 'Z',
  'ð•’': 'a', 'ð•“': 'b', 'ð•”': 'c', 'ð••': 'd', 'ð•–': 'e', 'ð•—': 'f',
  'ð•˜': 'g', 'ð•™': 'h', 'ð•š': 'i', 'ð•›': 'j', 'ð•œ': 'k', 'ð•': 'l',
  'ð•ž': 'm', 'ð•Ÿ': 'n', 'ð• ': 'o', 'ð•¡': 'p', 'ð•¢': 'q', 'ð•£': 'r',
  'ð•¤': 's', 'ð•¥': 't', 'ð•¦': 'u', 'ð•§': 'v', 'ð•¨': 'w', 'ð•©': 'x',
  'ð•ª': 'y', 'ð•«': 'z',

  // Circled Letters
  'â’¶': 'A', 'â’·': 'B', 'â’¸': 'C', 'â’¹': 'D', 'â’º': 'E', 'â’»': 'F',
  'â’¼': 'G', 'â’½': 'H', 'â’¾': 'I', 'â’¿': 'J', 'â“€': 'K', 'â“': 'L',
  'â“‚': 'M', 'â“ƒ': 'N', 'â“„': 'O', 'â“…': 'P', 'â“†': 'Q', 'â“‡': 'R',
  'â“ˆ': 'S', 'â“‰': 'T', 'â“Š': 'U', 'â“‹': 'V', 'â“Œ': 'W', 'â“': 'X',
  'â“Ž': 'Y', 'â“': 'Z',
  'â“': 'a', 'â“‘': 'b', 'â“’': 'c', 'â““': 'd', 'â“”': 'e', 'â“•': 'f',
  'â“–': 'g', 'â“—': 'h', 'â“˜': 'i', 'â“™': 'j', 'â“š': 'k', 'â“›': 'l',
  'â“œ': 'm', 'â“': 'n', 'â“ž': 'o', 'â“Ÿ': 'p', 'â“ ': 'q', 'â“¡': 'r',
  'â“¢': 's', 'â“£': 't', 'â“¤': 'u', 'â“¥': 'v', 'â“¦': 'w', 'â“§': 'x',
  'â“¨': 'y', 'â“©': 'z',

  // Circled (Filled) Letters
  'ðŸ…': 'a', 'ðŸ…‘': 'b', 'ðŸ…’': 'c', 'ðŸ…“': 'd', 'ðŸ…”': 'e', 'ðŸ…•': 'f',
  'ðŸ…–': 'g', 'ðŸ…—': 'h', 'ðŸ…˜': 'i', 'ðŸ…™': 'j', 'ðŸ…š': 'k', 'ðŸ…›': 'l',
  'ðŸ…œ': 'm', 'ðŸ…': 'n', 'ðŸ…ž': 'o', 'ðŸ…Ÿ': 'p', 'ðŸ… ': 'q', 'ðŸ…¡': 'r',
  'ðŸ…¢': 's', 'ðŸ…£': 't', 'ðŸ…¤': 'u', 'ðŸ…¥': 'v', 'ðŸ…¦': 'w', 'ðŸ…§': 'x',
  'ðŸ…¨': 'y', 'ðŸ…©': 'z',

  // Parenthesized Letters
  'ï¼ˆAï¼‰': 'A', 'ï¼ˆBï¼‰': 'B', 'ï¼ˆCï¼‰': 'C', 'ï¼ˆDï¼‰': 'D', 'ï¼ˆEï¼‰': 'E', 'ï¼ˆFï¼‰': 'F',
  'ï¼ˆGï¼‰': 'G', 'ï¼ˆHï¼‰': 'H', 'ï¼ˆIï¼‰': 'I', 'ï¼ˆJï¼‰': 'J', 'ï¼ˆKï¼‰': 'K', 'ï¼ˆLï¼‰': 'L',
  'ï¼ˆMï¼‰': 'M', 'ï¼ˆNï¼‰': 'N', 'ï¼ˆOï¼‰': 'O', 'ï¼ˆPï¼‰': 'P', 'ï¼ˆQï¼‰': 'Q', 'ï¼ˆRï¼‰': 'R',
  'ï¼ˆSï¼‰': 'S', 'ï¼ˆTï¼‰': 'T', 'ï¼ˆUï¼‰': 'U', 'ï¼ˆVï¼‰': 'V', 'ï¼ˆWï¼‰': 'W', 'ï¼ˆXï¼‰': 'X',
  'ï¼ˆYï¼‰': 'Y', 'ï¼ˆZï¼‰': 'Z',
  'ï¼ˆaï¼‰': 'a', 'ï¼ˆbï¼‰': 'b', 'ï¼ˆcï¼‰': 'c', 'ï¼ˆdï¼‰': 'd', 'ï¼ˆeï¼‰': 'e', 'ï¼ˆfï¼‰': 'f',
  'ï¼ˆgï¼‰': 'g', 'ï¼ˆhï¼‰': 'h', 'ï¼ˆiï¼‰': 'i', 'ï¼ˆjï¼‰': 'j', 'ï¼ˆkï¼‰': 'k', 'ï¼ˆlï¼‰': 'l',
  'ï¼ˆmï¼‰': 'm', 'ï¼ˆnï¼‰': 'n', 'ï¼ˆoï¼‰': 'o', 'ï¼ˆpï¼‰': 'p', 'ï¼ˆqï¼‰': 'q', 'ï¼ˆrï¼‰': 'r',
  'ï¼ˆsï¼‰': 's', 'ï¼ˆtï¼‰': 't', 'ï¼ˆuï¼‰': 'u', 'ï¼ˆvï¼‰': 'v', 'ï¼ˆwï¼‰': 'w', 'ï¼ˆxï¼‰': 'x',
  'ï¼ˆyï¼‰': 'y', 'ï¼ˆzï¼‰': 'z',

  // Regional Indicator Symbols
  'ðŸ‡¦': 'A', 'ðŸ‡§': 'B', 'ðŸ‡¨': 'C', 'ðŸ‡©': 'D', 'ðŸ‡ª': 'E', 'ðŸ‡«': 'F',
  'ðŸ‡¬': 'G', 'ðŸ‡­': 'H', 'ðŸ‡®': 'I', 'ðŸ‡¯': 'J', 'ðŸ‡°': 'K', 'ðŸ‡±': 'L',
  'ðŸ‡²': 'M', 'ðŸ‡³': 'N', 'ðŸ‡´': 'O', 'ðŸ‡µ': 'P', 'ðŸ‡¶': 'Q', 'ðŸ‡·': 'R',
  'ðŸ‡¸': 'S', 'ðŸ‡¹': 'T', 'ðŸ‡º': 'U', 'ðŸ‡»': 'V', 'ðŸ‡¼': 'W', 'ðŸ‡½': 'X',
  'ðŸ‡¾': 'Y', 'ðŸ‡¿': 'Z',
  'ðŸ‡¦': 'a', 'ðŸ‡§': 'b', 'ðŸ‡¨': 'c', 'ðŸ‡©': 'd', 'ðŸ‡ª': 'e', 'ðŸ‡«': 'f',
  'ðŸ‡¬': 'g', 'ðŸ‡­': 'h', 'ðŸ‡®': 'i', 'ðŸ‡¯': 'j', 'ðŸ‡°': 'k', 'ðŸ‡±': 'l',
  'ðŸ‡²': 'm', 'ðŸ‡³': 'n', 'ðŸ‡´': 'o', 'ðŸ‡µ': 'p', 'ðŸ‡¶': 'q', 'ðŸ‡·': 'r',
  'ðŸ‡¸': 's', 'ðŸ‡¹': 't', 'ðŸ‡º': 'u', 'ðŸ‡»': 'v', 'ðŸ‡¼': 'w', 'ðŸ‡½': 'x',
  'ðŸ‡¾': 'y', 'ðŸ‡¿': 'z',

  // Emoji huruf A-Z
  'ðŸ…°ï¸': 'a', 'ðŸ…±ï¸': 'b', 'ðŸ…²': 'c', 'ðŸ…³': 'd', 'ðŸ…´': 'e', 'ðŸ…µ': 'f',
  'ðŸ…¶': 'g', 'ðŸ…·': 'h', 'ðŸ…¸': 'i', 'ðŸ…¹': 'j', 'ðŸ…º': 'k', 'ðŸ…»': 'l',
  'ðŸ…¼': 'm', 'ðŸ…½': 'n', 'ðŸ…¾ï¸': 'o', 'ðŸ…¿ï¸': 'p', 'ðŸ†€': 'q', 'ðŸ†': 'r',
  'ðŸ†‚': 's', 'ðŸ†ƒ': 't', 'ðŸ†„': 'u', 'ðŸ†…': 'v', 'ðŸ††': 'w', 'ðŸ†‡': 'x',
  'ðŸ†ˆ': 'y', 'ðŸ†‰': 'z',
};

// Tambahkan versi dengan VARIATION SELECTOR-16 (FE0F)
const VARIATION_SELECTOR = '\uFE0F';
Object.keys(fancyCharMap).forEach((key) => {
  if (!key.includes(VARIATION_SELECTOR)) {
    fancyCharMap[key + VARIATION_SELECTOR] = fancyCharMap[key];
  }
  if (key.endsWith(VARIATION_SELECTOR)) {
    fancyCharMap[key.replace(VARIATION_SELECTOR, '')] = fancyCharMap[key];
  }
});

const replaceFancyLetters = (text) => {
  return splitter.splitGraphemes(text)
    .map(char => fancyCharMap[char] || char)
    .join('');
};

const sanitizeText = (text) => {
  return replaceFancyLetters(
    text
      .normalize('NFKC')                      // Normalisasi bentuk ke "Compatibility"
      .normalize('NFKD')                      // Pisahkan marks
      .replace(/[\u0300-\u036F]/g, '')        // Hilangkan diacritic/combining marks
      .replace(/[\u200B-\u200D\uFEFF]/g, '')  // Hilangkan zero-width dan sejenisnya
  ).replace(/[^\p{L}\p{N}]/gu, '')            // Hilangkan simbol selain huruf dan angka
   .toLowerCase();                            // Kecilkan huruf
};

const containsJudol = (text, bannedWords) => {
  const normalizedText = sanitizeText(text);
  for (const word of bannedWords) {
    if (normalizedText.includes(word)) {
      return word;
    }
  }
  return false;
};

export default containsJudol;
