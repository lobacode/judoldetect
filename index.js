import GraphemeSplitter from "grapheme-splitter";

const splitter = new GraphemeSplitter();

// Peta karakter huruf fancy ke huruf biasa (A-Z dan 0-9)
const fancyCharMap = {
  // Cyrillic → Latin (Visual Similarity)
  'А': 'A', 'Б': '6', 'В': 'B', 'Г': 'r', 'Д': 'A', 'Е': 'E', 'Ё': 'E', 'Ж': 'X', 'З': '3',
  'И': 'N', 'Й': 'N', 'К': 'K', 'Л': 'L', 'М': 'M', 'Н': 'H', 'О': 'O', 'П': 'N', 'Р': 'P',
  'С': 'C', 'Т': 'T', 'У': 'Y', 'Ф': 'O', 'Х': 'X', 'Ц': 'U', 'Ч': '4', 'Ш': 'W', 'Щ': 'W',
  'Ы': 'bl', 'Э': '3', 'Ю': 'IO', 'Я': 'R',

  'а': 'a', 'б': '6', 'в': 'b', 'г': 'r', 'д': 'a', 'е': 'e', 'ё': 'e', 'ж': 'x', 'з': '3',
  'и': 'n', 'й': 'n', 'к': 'k', 'л': 'l', 'м': 'm', 'н': 'h', 'о': 'o', 'п': 'n', 'р': 'p',
  'с': 'c', 'т': 't', 'у': 'y', 'ф': 'o', 'х': 'x', 'ц': 'u', 'ч': '4', 'ш': 'w', 'щ': 'w',
  'ы': 'bl', 'э': '3', 'ю': 'io', 'я': 'r',

  // Latin Fancy Letters (Visual Forms A-Z)
  'ᗩ': 'a', 'ᗷ': 'b', 'ᑕ': 'c', 'ᗪ': 'd', 'ᗴ': 'e', 'ᖴ': 'f',
  'ᘜ': 'g', 'ᕼ': 'h', 'Ꮖ': 'i', 'ᒍ': 'j', 'ᛕ': 'k', 'ᒪ': 'l',
  'ᗰ': 'm', 'ᑎ': 'n', 'ᗝ': 'o', 'ᝪ': 'o', 'ᑭ': 'p', 'ᑫ': 'q',
  'ᖇ': 'r', 'ᔕ': 's', 'ᑦ': 't', 'ᑌ': 'u', 'ᐯ': 'v', 'ᗯ': 'w',
  '᙭': 'x', 'ᖻ': 'y', 'ᘔ': 'z',

  // Bold Math (𝗔 - 𝗭)
  '𝗔': 'a', '𝗕': 'b', '𝗖': 'c', '𝗗': 'd', '𝗘': 'e', '𝗙': 'f',
  '𝗚': 'g', '𝗛': 'h', '𝗜': 'i', '𝗝': 'j', '𝗞': 'k', '𝗟': 'l',
  '𝗠': 'm', '𝗡': 'n', '𝗢': 'o', '𝗣': 'p', '𝗤': 'q', '𝗥': 'r',
  '𝗦': 's', '𝗧': 't', '𝗨': 'u', '𝗩': 'v', '𝗪': 'w', '𝗫': 'x',
  '𝗬': 'y', '𝗭': 'z',

  // Stylized Cursive (Mathematical Script)
  '𝒜': 'a', 'ℬ': 'b', '𝒞': 'c', '𝒟': 'd', 'ℰ': 'e', 'ℱ': 'f',
  '𝒢': 'g', 'ℋ': 'h', 'ℐ': 'i', '𝒥': 'j', '𝒦': 'k', 'ℒ': 'l',
  'ℳ': 'm', '𝒩': 'n', '𝒪': 'o', '𝒫': 'p', '𝒬': 'q', 'ℛ': 'r',
  '𝒮': 's', '𝒯': 't', '𝒰': 'u', '𝒱': 'v', '𝒲': 'w', '𝒳': 'x',
  '𝒴': 'y', '𝒵': 'z',
  '𝒶': 'a', '𝒷': 'b', '𝒸': 'c', '𝒹': 'd', 'ℯ': 'e', '𝒻': 'f',
  '𝓰': 'g', '𝒽': 'h', '𝒾': 'i', '𝒿': 'j', '𝓀': 'k', '𝓁': 'l',
  '𝓂': 'm', '𝓃': 'n', 'ℴ': 'o', '𝓅': 'p', '𝓆': 'q', '𝓇': 'r',
  '𝓈': 's', '𝓉': 't', '𝓊': 'u', '𝓋': 'v', '𝓌': 'w', '𝓍': 'x',
  '𝓎': 'y', '𝓏': 'z',

  // Angka fancy
  '𝟎': '0', '𝟏': '1', '𝟐': '2', '𝟑': '3', '𝟒': '4',
  '𝟓': '5', '𝟔': '6', '𝟕': '7', '𝟖': '8', '𝟗': '9',

  // Fullwidth Letters
  'Ａ': 'A', 'Ｂ': 'B', 'Ｃ': 'C', 'Ｄ': 'D', 'Ｅ': 'E', 'Ｆ': 'F',
  'Ｇ': 'G', 'Ｈ': 'H', 'Ｉ': 'I', 'Ｊ': 'J', 'Ｋ': 'K', 'Ｌ': 'L',
  'Ｍ': 'M', 'Ｎ': 'N', 'Ｏ': 'O', 'Ｐ': 'P', 'Ｑ': 'Q', 'Ｒ': 'R',
  'Ｓ': 'S', 'Ｔ': 'T', 'Ｕ': 'U', 'Ｖ': 'V', 'Ｗ': 'W', 'Ｘ': 'X',
  'Ｙ': 'Y', 'Ｚ': 'Z',
  'ａ': 'a', 'ｂ': 'b', 'ｃ': 'c', 'ｄ': 'd', 'ｅ': 'e', 'ｆ': 'f',
  'ｇ': 'g', 'ｈ': 'h', 'ｉ': 'i', 'ｊ': 'j', 'ｋ': 'k', 'ｌ': 'l',
  'ｍ': 'm', 'ｎ': 'n', 'ｏ': 'o', 'ｐ': 'p', 'ｑ': 'q', 'ｒ': 'r',
  'ｓ': 's', 'ｔ': 't', 'ｕ': 'u', 'ｖ': 'v', 'ｗ': 'w', 'ｘ': 'x',
  'ｙ': 'y', 'ｚ': 'z',

  // Fraktur Letters
  '𝔄': 'A', '𝔅': 'B', '𝔇': 'D', '𝔈': 'E', '𝔉': 'F', '𝔊': 'G',
  '𝔍': 'J', '𝔎': 'K', '𝔏': 'L', '𝔐': 'M', '𝔑': 'N', '𝔒': 'O',
  '𝔓': 'P', '𝔔': 'Q', '𝔖': 'S', '𝔘': 'U', '𝔙': 'V', '𝔚': 'W',
  '𝔛': 'X', '𝔜': 'Y', '𝔷': 'Z',
  '𝔞': 'a', '𝔟': 'b', '𝔠': 'c', '𝔡': 'd', '𝔢': 'e', '𝔣': 'f',
  '𝔤': 'g', '𝔥': 'h', '𝔦': 'i', '𝔧': 'j', '𝔨': 'k', '𝔩': 'l',
  '𝔪': 'm', '𝔫': 'n', '𝔬': 'o', '𝔭': 'p', '𝔮': 'q', '𝔯': 'r',
  '𝔰': 's', '𝔱': 't', '𝔲': 'u', '𝔳': 'v', '𝔴': 'w', '𝔵': 'x',
  '𝔶': 'y', '𝔷': 'z',

  // Double-Struck Letters
  '𝔸': 'A', '𝔹': 'B', 'ℂ': 'C', '𝔻': 'D', '𝔼': 'E', 'ℱ': 'F',
  '𝔾': 'G', 'ℍ': 'H', '𝕀': 'I', '𝕁': 'J', '𝕂': 'K', '𝕃': 'L',
  '𝕄': 'M', 'ℕ': 'N', '𝕆': 'O', 'ℙ': 'P', 'ℚ': 'Q', 'ℝ': 'R',
  '𝕊': 'S', '𝕋': 'T', '𝕌': 'U', '𝕍': 'V', '𝕎': 'W', '𝕏': 'X',
  '𝕐': 'Y', 'ℤ': 'Z',
  '𝕒': 'a', '𝕓': 'b', '𝕔': 'c', '𝕕': 'd', '𝕖': 'e', '𝕗': 'f',
  '𝕘': 'g', '𝕙': 'h', '𝕚': 'i', '𝕛': 'j', '𝕜': 'k', '𝕝': 'l',
  '𝕞': 'm', '𝕟': 'n', '𝕠': 'o', '𝕡': 'p', '𝕢': 'q', '𝕣': 'r',
  '𝕤': 's', '𝕥': 't', '𝕦': 'u', '𝕧': 'v', '𝕨': 'w', '𝕩': 'x',
  '𝕪': 'y', '𝕫': 'z',

  // Circled Letters
  'Ⓐ': 'A', 'Ⓑ': 'B', 'Ⓒ': 'C', 'Ⓓ': 'D', 'Ⓔ': 'E', 'Ⓕ': 'F',
  'Ⓖ': 'G', 'Ⓗ': 'H', 'Ⓘ': 'I', 'Ⓙ': 'J', 'Ⓚ': 'K', 'Ⓛ': 'L',
  'Ⓜ': 'M', 'Ⓝ': 'N', 'Ⓞ': 'O', 'Ⓟ': 'P', 'Ⓠ': 'Q', 'Ⓡ': 'R',
  'Ⓢ': 'S', 'Ⓣ': 'T', 'Ⓤ': 'U', 'Ⓥ': 'V', 'Ⓦ': 'W', 'Ⓧ': 'X',
  'Ⓨ': 'Y', 'Ⓩ': 'Z',
  'ⓐ': 'a', 'ⓑ': 'b', 'ⓒ': 'c', 'ⓓ': 'd', 'ⓔ': 'e', 'ⓕ': 'f',
  'ⓖ': 'g', 'ⓗ': 'h', 'ⓘ': 'i', 'ⓙ': 'j', 'ⓚ': 'k', 'ⓛ': 'l',
  'ⓜ': 'm', 'ⓝ': 'n', 'ⓞ': 'o', 'ⓟ': 'p', 'ⓠ': 'q', 'ⓡ': 'r',
  'ⓢ': 's', 'ⓣ': 't', 'ⓤ': 'u', 'ⓥ': 'v', 'ⓦ': 'w', 'ⓧ': 'x',
  'ⓨ': 'y', 'ⓩ': 'z',

  // Circled (Filled) Letters
  '🅐': 'a', '🅑': 'b', '🅒': 'c', '🅓': 'd', '🅔': 'e', '🅕': 'f',
  '🅖': 'g', '🅗': 'h', '🅘': 'i', '🅙': 'j', '🅚': 'k', '🅛': 'l',
  '🅜': 'm', '🅝': 'n', '🅞': 'o', '🅟': 'p', '🅠': 'q', '🅡': 'r',
  '🅢': 's', '🅣': 't', '🅤': 'u', '🅥': 'v', '🅦': 'w', '🅧': 'x',
  '🅨': 'y', '🅩': 'z',

  // Parenthesized Letters
  '（A）': 'A', '（B）': 'B', '（C）': 'C', '（D）': 'D', '（E）': 'E', '（F）': 'F',
  '（G）': 'G', '（H）': 'H', '（I）': 'I', '（J）': 'J', '（K）': 'K', '（L）': 'L',
  '（M）': 'M', '（N）': 'N', '（O）': 'O', '（P）': 'P', '（Q）': 'Q', '（R）': 'R',
  '（S）': 'S', '（T）': 'T', '（U）': 'U', '（V）': 'V', '（W）': 'W', '（X）': 'X',
  '（Y）': 'Y', '（Z）': 'Z',
  '（a）': 'a', '（b）': 'b', '（c）': 'c', '（d）': 'd', '（e）': 'e', '（f）': 'f',
  '（g）': 'g', '（h）': 'h', '（i）': 'i', '（j）': 'j', '（k）': 'k', '（l）': 'l',
  '（m）': 'm', '（n）': 'n', '（o）': 'o', '（p）': 'p', '（q）': 'q', '（r）': 'r',
  '（s）': 's', '（t）': 't', '（u）': 'u', '（v）': 'v', '（w）': 'w', '（x）': 'x',
  '（y）': 'y', '（z）': 'z',

  // Regional Indicator Symbols
  '🇦': 'A', '🇧': 'B', '🇨': 'C', '🇩': 'D', '🇪': 'E', '🇫': 'F',
  '🇬': 'G', '🇭': 'H', '🇮': 'I', '🇯': 'J', '🇰': 'K', '🇱': 'L',
  '🇲': 'M', '🇳': 'N', '🇴': 'O', '🇵': 'P', '🇶': 'Q', '🇷': 'R',
  '🇸': 'S', '🇹': 'T', '🇺': 'U', '🇻': 'V', '🇼': 'W', '🇽': 'X',
  '🇾': 'Y', '🇿': 'Z',
  '🇦': 'a', '🇧': 'b', '🇨': 'c', '🇩': 'd', '🇪': 'e', '🇫': 'f',
  '🇬': 'g', '🇭': 'h', '🇮': 'i', '🇯': 'j', '🇰': 'k', '🇱': 'l',
  '🇲': 'm', '🇳': 'n', '🇴': 'o', '🇵': 'p', '🇶': 'q', '🇷': 'r',
  '🇸': 's', '🇹': 't', '🇺': 'u', '🇻': 'v', '🇼': 'w', '🇽': 'x',
  '🇾': 'y', '🇿': 'z',

  // Emoji huruf A-Z
  '🅰️': 'a', '🅱️': 'b', '🅲': 'c', '🅳': 'd', '🅴': 'e', '🅵': 'f',
  '🅶': 'g', '🅷': 'h', '🅸': 'i', '🅹': 'j', '🅺': 'k', '🅻': 'l',
  '🅼': 'm', '🅽': 'n', '🅾️': 'o', '🅿️': 'p', '🆀': 'q', '🆁': 'r',
  '🆂': 's', '🆃': 't', '🆄': 'u', '🆅': 'v', '🆆': 'w', '🆇': 'x',
  '🆈': 'y', '🆉': 'z',
};

// Tambahkan versi dengan VARIATION SELECTOR-16 (FE0F)
const VARIATION_SELECTOR = '\uFE0F';
Object.keys(fancyCharMap).forEach((key) => {
  if (!key.includes(VARIATION_SELECTOR)) {
    fancyCharMap[key + VARIATION_SELECTOR] = fancyCharMap[key];
  }
  if (key.endsWith(VARIATION_SELECTOR)) {
    fancyCharMap[key.replace(VARIATION_SELECTOR, '')] = fancyCharMap[key];
  }
});

const replaceFancyLetters = (text) => {
  return splitter.splitGraphemes(text)
    .map(char => fancyCharMap[char] || char)
    .join('');
};

const sanitizeText = (text) => {
  return replaceFancyLetters(
    text
      .normalize('NFKC')                      // Normalisasi bentuk ke "Compatibility"
      .normalize('NFKD')                      // Pisahkan marks
      .replace(/[\u0300-\u036F]/g, '')        // Hilangkan diacritic/combining marks
      .replace(/[\u200B-\u200D\uFEFF]/g, '')  // Hilangkan zero-width dan sejenisnya
  ).replace(/[^\p{L}\p{N}]/gu, '')            // Hilangkan simbol selain huruf dan angka
   .toLowerCase();                            // Kecilkan huruf
};

const containsJudol = (text, bannedWords) => {
  const normalizedText = sanitizeText(text);
  for (const word of bannedWords) {
    if (normalizedText.includes(word)) {
      return word;
    }
  }
  return false;
};

export default containsJudol;
